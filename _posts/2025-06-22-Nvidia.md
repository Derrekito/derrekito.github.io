## Fixing NVIDIA RTX 5070 Ti GPU Detection Issues on Arch Linux

The NVIDIA RTX 5070 Ti GPU may fail to initialize properly on Arch Linux due to recent changes in NVIDIA's driver support model. Typical symptoms include:

* `nvidia-smi` reporting:

  ```
  No devices were found
  ```

* Failed attempts to start graphical interfaces (Xorg, Wayland):

  ```
  (EE) No screens found
  ```

* Kernel logs (`dmesg`) containing:

  ```
  NVRM: This GPU requires the NVIDIA open kernel modules
  ```

### Root Cause

NVIDIA has ceased adding support for newer GPUs, including the RTX 5070 Ti, to its proprietary kernel module (`nvidia`). Instead, newer GPU models require the open-source kernel driver (`nvidia-open`).

### Step-by-Step Solution

**1. Remove Proprietary NVIDIA Drivers**

```bash
sudo pacman -Rns nvidia nvidia-utils
```

**2. Install Open-Source NVIDIA Kernel Modules**

```bash
sudo pacman -S nvidia-open-dkms nvidia-utils
```

The `nvidia-open-dkms` package automatically rebuilds the module when kernel updates occur.

**3. Regenerate Initial RAM Filesystem (initramfs)**

```bash
sudo mkinitcpio -P
```

**4. Reboot to Apply Changes**

```bash
sudo reboot
```

### Optional Xorg Configuration (If Needed)

In some rare cases, automatic detection may fail. You may manually configure Xorg as follows:

Create or edit `/etc/X11/xorg.conf.d/10-nvidia.conf`:

```ini
Section "Device"
    Identifier "RTX5070Ti"
    Driver     "nvidia"
    BusID      "PCI:1:0:0"        # Verify via `lspci`
    Option     "AllowEmptyInitialConfiguration" "true"
EndSection
```

### Verification Steps

After rebooting, ensure your GPU is correctly recognized:

* Verify GPU detection:

  ```bash
  nvidia-smi
  ```

  Your RTX 5070 Ti should now appear.

* Verify loaded modules:

  ```bash
  lsmod | grep nvidia
  ```

  Expected modules: `nvidia`, `nvidia_drm`, `nvidia_modeset`.

* Launch graphical environment:

  ```bash
  startx
  ```

  The desktop environment should start without errors.

### Troubleshooting Common Issues

* **GPU still undetected**: Confirm all proprietary drivers are fully removed and the open-source driver installed correctly. Repeat the above steps carefully.
* **Persistent Xorg issues**: Ensure your manual Xorg configuration file references the correct PCI address (check via `lspci | grep NVIDIA`).
* **DKMS build errors after kernel updates**: Manually trigger a rebuild:

  ```bash
  sudo dkms autoinstall
  ```

### Conclusion

The RTX 5070 Ti GPU no longer receives support from the proprietary NVIDIA kernel module. Switching to the open-source driver (`nvidia-open-dkms`) is mandatory to ensure full functionality under Arch Linux.
